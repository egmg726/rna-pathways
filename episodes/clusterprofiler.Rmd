---
title: 'Gene Ontology testing with `clusterProfiler`'
teaching: 10
exercises: 2
---

:::::::::::::::::::::::::::::::::::::: questions 

- What is clusterProfiler?

::::::::::::::::::::::::::::::::::::::::::::::::

::::::::::::::::::::::::::::::::::::: objectives

- Explain how to use markdown with the new lesson template
- Demonstrate how to include pieces of code, figures, and nested challenge blocks

::::::::::::::::::::::::::::::::::::::::::::::::

```{r, message=FALSE,warning=FALSE,echo=FALSE}

library(edgeR)
library(goseq)
library(fgsea)
library(EGSEA)
library(clusterProfiler)
library(org.Mm.eg.db)
library(ggplot2)
library(enrichplot)
library(pathview)
library(edgeR)
library(impute)
library(preprocessCore)
library(RegEnrich)

debasal <- read.csv("data/limma-voom_basalpregnant-basallactate", header = TRUE, sep = "\t")
deluminal <- read.csv("data/limma-voom_luminalpregnant-luminallactate", header = TRUE, sep = "\t")
seqdata <- read.csv("data/seqdata", header = TRUE, sep = "\t")
load("data/mouse_hallmark_sets.RData")
# loads as Mm.H

factordata <- read.table("data/factordata", header = TRUE, sep = "\t")
filteredcounts <- read.csv("data/limma-voom_filtered_counts", header = TRUE, sep = "\t")


```


## Gene Ontology testing with `clusterProfiler`


```{r}

debasal$Status <- debasal$adj.P.Val < 0.01
gene <- debasal$ENTREZID[debasal$Status]


ego <- enrichGO(gene          = gene,
                OrgDb         = org.Mm.eg.db,
                keyType       = 'ENTREZID',
                ont           = "CC",
                pAdjustMethod = "BH",
                pvalueCutoff  = 0.01,
                qvalueCutoff  = 0.05,
                readable = TRUE)
head(ego)



```



```{r}

dotplot(ego)

```



::::: challenge

Repeat this analysis using `deluminal` data. Are the enriched pathways similar?


:::::


```{r}


debasal_genelist <- debasal$logFC
names(debasal_genelist) <- debasal$ENTREZID
debasal_genelist <- sort(debasal_genelist, decreasing = TRUE)


ego3 <- gseGO(gene          = debasal_genelist,
                OrgDb         = org.Mm.eg.db,
                keyType       = 'ENTREZID',
                ont           = "CC",
              minGSSize    = 100,
              maxGSSize    = 500,
              pvalueCutoff = 0.05,
              verbose      = FALSE)
head(ego3)


```

```{r}

dotplot(ego3)

```


## What is GSEA?

*Brief explanation/refresh here if not explained in intro*

## Gene Set Enrichment Analysis (GSEA)

```{r}
gseaplot(ego3, by = "all",title = ego3$Description[1],geneSetID = 1)
#title = gse$Description[1], geneSetID = 1)

```

Plot of number of articles using the term:

```{r}

# From https://learn.gencore.bio.nyu.edu/rna-seq-analysis/gene-set-enrichment-analysis/

terms <- ego3$Description[1:3]
pmcplot(terms, 2020:2025, proportion=FALSE)


```





::::::::::::::::::::::::::::::::::::: keypoints 

- clusterProfiler makes cool plots!

::::::::::::::::::::::::::::::::::::::::::::::::

